<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Searches for media files in the Macaulay Library — query_macaulay • suwo</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Searches for media files in the Macaulay Library — query_macaulay"><meta name="description" content="query_macaulay searches for metadata from
macaulay."><meta property="og:description" content="query_macaulay searches for metadata from
macaulay."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">suwo</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/suwo.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/maRce10/suwo/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Searches for media files in the Macaulay Library</h1>
      <small class="dont-index">Source: <a href="https://github.com/maRce10/suwo/blob/master/R/query_macaulay.R" class="external-link"><code>R/query_macaulay.R</code></a></small>
      <div class="d-none name"><code>query_macaulay.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>query_macaulay</code> searches for metadata from
<a href="https://https://www.macaulaylibrary.org/" class="external-link">macaulay</a>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">query_macaulay</span><span class="op">(</span></span>
<span>  species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"species"</span><span class="op">)</span>,</span>
<span>  format <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sound"</span>, <span class="st">"image"</span>, <span class="st">"video"</span><span class="op">)</span>,</span>
<span>  verbose <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"verbose"</span>, <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  all_data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"all_data"</span>, <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>  raw_data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"raw_data"</span>, <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>  path <span class="op">=</span> <span class="st">"."</span>,</span>
<span>  files <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  dates <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  taxon_code_info <span class="op">=</span> <span class="va">ml_taxon_code</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-species">species<a class="anchor" aria-label="anchor" href="#arg-species"></a></dt>
<dd><p>Character string with the scientific name of a species in
the format: "Genus epithet". Required. Can be set globally for the current
R session via the "term" option
(e.g. <code>options(term = "Hypsiboas rufitelus")</code>).</p></dd>


<dt id="arg-format">format<a class="anchor" aria-label="anchor" href="#arg-format"></a></dt>
<dd><p>Character vector with the media format to query for. Options
are 'sound', 'image' of 'video'. Required.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>Logical argument that determines if text is shown in
console. Default is <code>TRUE</code>. Can be set globally for the current R
session via the "verbose" option ( <code>options(verbose = TRUE)</code>).</p></dd>


<dt id="arg-all-data">all_data<a class="anchor" aria-label="anchor" href="#arg-all-data"></a></dt>
<dd><p>Logical argument that determines if all data available
from database is shown in the results of search. Default is <code>FALSE</code>.
Can be set globally for the current R session via the "all_data"
option ( <code>options(all_data = TRUE)</code>).</p></dd>


<dt id="arg-raw-data">raw_data<a class="anchor" aria-label="anchor" href="#arg-raw-data"></a></dt>
<dd><p>Logical argument that determines if the raw data from the
API is returned (e.g. without any manipulation). Default is <code>FALSE</code>.
Can be set globally for the current R session via the "raw_data"
option ( <code>options(raw_data = TRUE)</code>). If <code>TRUE</code>  <code>all_data</code>
is set to <code>TRUE</code> internally. Useful for developers, or if users
suspect that some data is mishandled during processing
(i.e. date information is lost). Note that the metadata obtained
when <code>raw_data = TRUE</code> is not standardized, so most suwo functions
for downstream steps will not work on them.</p></dd>


<dt id="arg-path">path<a class="anchor" aria-label="anchor" href="#arg-path"></a></dt>
<dd><p>Directory path where the .csv file will be saved. By default it
is saved into the current working directory (<code>"."</code>).</p></dd>


<dt id="arg-files">files<a class="anchor" aria-label="anchor" href="#arg-files"></a></dt>
<dd><p>Optional character vector with the name(s) of the .csv file(s)
to read. If not provided, the function will open a browser window to the
search results page, where the user must download a .csv file with the
metadata.</p></dd>


<dt id="arg-dates">dates<a class="anchor" aria-label="anchor" href="#arg-dates"></a></dt>
<dd><p>Optional numeric vector with years to split the search. If
provided, the function will perform separate queries for each date range
(between consecutive date values) and combine the results. Useful for
queries that return large number of results (i.e. &gt; 10000 results limit).
For example, to search for the species between 2010 to 2020 and between 2021
to 2025 use <code>dates = c(2010, 2020, 2025)</code>. If years contain decimals
searches will be split by months within years as well.</p></dd>


<dt id="arg-taxon-code-info">taxon_code_info<a class="anchor" aria-label="anchor" href="#arg-taxon-code-info"></a></dt>
<dd><p>Data frame containing the taxon code information.
By default the function will use the internal data frame
<code>"ml_taxon_code"</code> included as example data in the package. This object
contains the data from the Clement list from october 2024
(downloaded from <a href="https://www.birds.cornell.edu/clementschecklist/introduction/updateindex/october-2024/2024-citation-checklist-downloads/" class="external-link">https://www.birds.cornell.edu/clementschecklist/introduction/updateindex/october-2024/2024-citation-checklist-downloads/</a>). If new versions of the list become available it will be updated in new package versions. However, if users need to update it they can download the new list version, read it in R as a data frame and provide it to the function through this argument.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>The function returns a data frame with the metadata of the media
files matching the search criteria. If <code>all_data = TRUE</code>, all metadata
fields (columns) are returned. If <code>raw_data = TRUE</code>, the raw data as
obtained from the repository is returned (without any formatting).</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This function queries for species observation info in the
<a href="https://https://www.macaulaylibrary.org/" class="external-link">Macaulay Library</a> online
repository and returns the metadata of media files matching the query. The
Macaulay Library is the world’s largest repository of digital media
(audio, photo, and video) of wildlife, and their habitats. The archive
hosts more than 77 million images, 3 million sound recordings, and
350k videos, from more than 80k contributors, and is integrated with
eBird, the world’s largest biodiversity dataset. This is an interactive
function which opens a browser window to the Macaulay Library's search page,
where the user must download a .csv file with the metadata. The function
then reads the .csv file and returns a data frame with the metadata.</p>
<p>Here are some instructions for using this function properly:</p><ul><li><p>Users must save the save the .csv file manually</p></li>
<li><p><em>If the file is saved overwritting a pre-existing file
   (i.e. same file name) the function will not detect it</em></p></li>
<li><p>A maximum of 10000 records per query can be returned,
   but this can be bypassed by using the <code>dates</code> argument to split
   the search into smaller date ranges</p></li>
<li><p>Users must log in to the Macaulay Library/eBird account in order
   to access large batches of observations</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Scholes III, Ph.D. E (2015). Macaulay Library Audio and Video Collection.
Cornell Lab of Ornithology. Occurrence dataset
https://doi.org/10.15468/ckcdpy accessed via GBIF.org on 2024-05-09.
Clements, J. F., P. C. Rasmussen, T. S. Schulenberg, M. J. Iliff,
T. A. Fredericks, J. A. Gerbracht, D. Lepage, A. Spencer, S. M. Billerman,
B. L. Sullivan, M. Smith, and C. L. Wood. 2024. The eBird/Clements
checklist of Birds of the World: v2024.</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Marcelo Araya-Salas (<a href="mailto:marcelo.araya@ucr.ac.cr">marcelo.araya@ucr.ac.cr</a>)</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># query sounds</span></span></span>
<span class="r-in"><span><span class="va">tur_ili</span> <span class="op">&lt;-</span> <span class="fu">query_macaulay</span><span class="op">(</span>species <span class="op">=</span> <span class="st">"Turdus iliacus"</span>, format <span class="op">=</span> <span class="st">"sound"</span>,</span></span>
<span class="r-in"><span>path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># test a query with more than 10000 results paging by date</span></span></span>
<span class="r-in"><span><span class="va">cal_cos</span> <span class="op">&lt;-</span> <span class="fu">query_macaulay</span><span class="op">(</span>species <span class="op">=</span> <span class="st">"Calypte costae"</span>, format <span class="op">=</span> <span class="st">"image"</span>,</span></span>
<span class="r-in"><span>path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, dates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1976</span>, <span class="fl">2019</span>, <span class="fl">2022</span>, <span class="fl">2024</span>, <span class="fl">2025</span>, <span class="fl">2026</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># this is how the internal function that splits the search by year intervals</span></span></span>
<span class="r-in"><span><span class="va">works</span></span></span>
<span class="r-in"><span><span class="co"># it can split by entire year intervals</span></span></span>
<span class="r-in"><span><span class="fu">suwo</span><span class="fu">:::</span><span class="fu">.date_ranges</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1976</span>, <span class="fl">2020</span>, <span class="fl">2022</span>, <span class="fl">2024</span>, <span class="fl">2025</span>, <span class="fl">2026</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># or by year-month intervals if dates have decimals</span></span></span>
<span class="r-in"><span><span class="co"># (note that it cannot split across years)</span></span></span>
<span class="r-in"><span><span class="fu">suwo</span><span class="fu">:::</span><span class="fu">.date_ranges</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">2020</span>, <span class="fl">2026</span>, length.out <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## update clement list (note that this is actually the same list used in the</span></span></span>
<span class="r-in"><span><span class="co"># current 'suwo' version, just for the sake of the example)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># url to the clements list version october 2024</span></span></span>
<span class="r-in"><span><span class="co"># (split so it is not truncaded by CRAN)</span></span></span>
<span class="r-in"><span><span class="va">clements_url</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span></span>
<span class="r-in"><span><span class="st">"https://www.birds.cornell.edu/clementschecklist/wp-content/uploads/2024/10"</span>,</span></span>
<span class="r-in"><span><span class="st">"/Clements-v2024-October-2024-rev.csv"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># read list from url</span></span></span>
<span class="r-in"><span><span class="va">new_clements</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="va">clements_url</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># provide "updated" clements list to query_macaulay()</span></span></span>
<span class="r-in"><span><span class="va">tur_ili2</span> <span class="op">&lt;-</span> <span class="fu">query_macaulay</span><span class="op">(</span>species <span class="op">=</span> <span class="st">"Turdus iliacus"</span>, format <span class="op">=</span> <span class="st">"sound"</span>,</span></span>
<span class="r-in"><span> taxon_code_info <span class="op">=</span> <span class="va">new_clements</span>, path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Marcelo Araya-Salas, Jorge Elizondo-Calvo.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

