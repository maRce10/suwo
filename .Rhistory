`Taxonomic coverage` = tax_coverage,
`Additional data` = additional_data,
`Other features` = other,
stringsAsFactors = FALSE,
check.names = FALSE
)
library(knitr)
library(kableExtra)
metadata_list <-  vignette_metadata <- suwo:::vignette_metadata
Repository <- vapply(metadata_list, function(x)
x[1, "repository"], character(1))
names(metadata_list) <- tolower(Repository)
Function <- c(
gbif = "query_gbif",
inaturalist = "query_inaturalist",
`macaulay library` =  "query_macaulay",
observation = "query_observation",
wikiaves = "query_wikiaves",
`xeno-canto` = "query_xenocanto"
)
Function <- Function[match(names(metadata_list), names(Function))]
file_types <- vapply(Function, function(x)
paste(formals(get(x))$format, collapse = ", "), FUN.VALUE = character(1))
file_types <- gsub("c, ", "", file_types)
file_types[Function == "query_xenocanto"] <- "sound"
urls <- c(
gbif = "https://www.gbif.org/",
inaturalist = "https://www.inaturalist.org/",
`macaulay library` =  "https://www.macaulaylibrary.org/",
observation = "https://observation.org/",
wikiaves = "https://www.wikiaves.com.br/",
`xeno-canto` = "https://www.xeno-canto.org/"
)
urls <- urls[match(names(metadata_list), names(urls))]
token <- c(
gbif = "No",
inaturalist = "No",
`macaulay library` =  "No",
observation = "Yes",
wikiaves = "No",
`xeno-canto` = "Yes"
)
token <- token[match(names(metadata_list), names(token))]
tax_level <-  c(
gbif = "Species",
inaturalist = "Species",
`macaulay library` =  "Species",
observation = "Species",
wikiaves = "Species",
`xeno-canto` = "Species, subspecies, genus, family, group"
)
tax_level <- tax_level[match(names(metadata_list), names(tax_level))]
geo_cover <-  c(
gbif = "Global",
inaturalist = "Global",
`macaulay library` =  "Global",
observation = "Global",
wikiaves = "Brazil",
`xeno-canto` = "Global"
)
geo_cover <- geo_cover[match(names(metadata_list), names(geo_cover))]
tax_coverage <-  c(
gbif = "All life",
inaturalist = "All life",
`macaulay library` =  "Mostly birds but also other vertebrate and
invertebrate animals",
observation = NA,
wikiaves = "Birds",
`xeno-canto` = "Birds, frogs, non-marine mammals and grasshoppers"
)
tax_coverage <- tax_coverage[match(names(metadata_list), names(tax_coverage))]
other <-  c(
gbif = "Specify query by data base",
inaturalist = NA,
`macaulay library` =  "Interactive",
observation = NA,
wikiaves = NA,
`xeno-canto` = "Specify query by taxonomy, geographic range and dates"
)
other <- other[match(names(metadata_list), names(other))]
colnames <- lapply(metadata_list, names)
colnames <- lapply(colnames, function(x)
setdiff(x, suwo:::.format_query_output(only_basic_columns = TRUE)))
additional_data <- vapply(colnames, function(x)
paste(x, collapse = ", "), FUN.VALUE = character(1))
additional_data <- additional_data[match(names(metadata_list),
names(additional_data))]
query_summary <- data.frame(
Function = Function,
Repository = Repository,
`URL link` = urls,
`File types` = file_types,
`Requires api key` = token,
`Taxonomic level` = tax_level,
`Geographic coverage` = geo_cover,
`Taxonomic coverage` = tax_coverage,
`Additional data` = additional_data,
`Other features` = other,
stringsAsFactors = FALSE,
check.names = FALSE
)
# remove duplicates
query_summary <- query_summary[!duplicated(query_summary$Repository), ]
query_summary <- query_summary[order(query_summary$Repository),]
query_summary$`URL link` <- kableExtra::cell_spec(query_summary$`URL link`,
"html",
link = query_summary$`URL link`,
new_tab = TRUE)
query_summary$Function <- kableExtra::cell_spec(
query_summary$Function,
"html",
link = paste0(
"https://marce10.github.io/suwo/reference/",
query_summary$Function,
".html"
),
new_tab = TRUE
)
query_summary[, names(query_summary) != "Additional data"] |>
kableExtra::kbl(
caption =
"Table 1: Summary of query functions and the associated repositories.",
format = "html",
escape = FALSE,
row.names = FALSE
) |>
kableExtra::kable_styling(
bootstrap_options = c("striped", "hover", "condensed", "responsive"),
full_width = FALSE,
position = "left"
)
?knitr::kable()
install.packages("revgeo")
h_peckii <- query_inaturalist(species = 'Hydnellum peckii', format = "image")
h_peckii$country
lintr::lint_package(linters =  list(lintr::line_length_linter()))
query_summary$Repository
The [suwo](https://marce10.github.io/suwo/) package aims to simplify the
dat <- read.csv("~/Descargas/clusters_with_umap_centroid_assignment.csv")
head(dat)
str(dat)
pair_dist <- dist(dat[, c("umap1", "umap2")])
class(pair_dist)
pair_dist_df <- as.matrix(pair_dist)
str(pair_dist_df)
pair_dist_df[1, 74]
all(diag(pair_dist_df == 0))
library(pbapply)
dat$closest_10_dist <-unlist(pblapply(1:nrow(pair_dist_df), function(x){
xdist <- pair_dist_df[x, ]
xdist <- xdist[dat$species != dat$species[x]]
closest_10_dist <- mean(sort(xdist)[1:10])
return(closest_10_dist)
})
)
library(ggplot2)
# boxplot de closest_10_dist por especie
ggplot(dat, aes(x = species, y = closest_10_dist)) +
geom_boxplot() +
theme_minimal() +
labs(title = "Distancia promedio a los 10 puntos más cercanos de otras especies",
x = "Especie",
y = "Distancia promedio a los 10 puntos más cercanos")
x = 1
xdist <- pair_dist_df[x, ]
sp <- dat$species[dat$species != dat$species[x]]
xdist <- xdist[dat$species != dat$species[x]]
sp
table(sp)
tap_sp <- table(sp)
min(tap_sp)
table(dat$species)
i <- 1
rarefied_xdist <- unlist(lapply(names(tap_sp), function(s){
s_dist <- xdist[sp == s]
if(length(s_dist) > rare_n){
s_dist <- sample(s_dist, rare_n)
}
return(s_dist)
}))
rare_n <- 11
rarefied_xdist <- unlist(lapply(names(tap_sp), function(s){
s_dist <- xdist[sp == s]
if(length(s_dist) > rare_n){
s_dist <- sample(s_dist, rare_n)
}
return(s_dist)
}))
rarefied_xdist
rarefied_xdist <- unlist(lapply(names(tap_sp), function(s){
s_dist <- xdist[sp == s]
if(length(s_dist) > rare_n){
s_dist <- sample(s_dist, rare_n)
}
return(s_dist)
closest_10_dist <- mean(sort(xdist)[1:10])
}))
rarefied_xdist
rarefied_xdist <- unlist(lapply(names(tap_sp), function(s){
s_dist <- xdist[sp == s]
if(length(s_dist) > rare_n){
s_dist <- sample(s_dist, rare_n)
}
return(s_dist)
}))
rarefied_xdist
length(rarefied_xdist)
names(tap_sp)
14 *11
rarefied_xdist
closest_10_dist <- mean(sort(rarefied_xdist)[1:10])
closest_10_dist
# rafefact number of observations per species
# get randomly 11 observations per each species from dat
closest_10_dist <- sapply(1:100, function(i){
rarefied_xdist <- unlist(lapply(names(tap_sp), function(s){
s_dist <- xdist[sp == s]
if(length(s_dist) > rare_n){
s_dist <- sample(s_dist, rare_n)
}
return(s_dist)
})
)
out <- mean(sort(rarefied_xdist)[1:10])
return(out)
})
dat$closest_10_dist <-unlist(pblapply(1:nrow(pair_dist_df), function(x){
dat$closest_10_dist <-unlist(pblapply(1:nrow(pair_dist_df), function(x){
xdist <- pair_dist_df[x, ]
sp <- dat$species[dat$species != dat$species[x]]
xdist <- xdist[dat$species != dat$species[x]]
tap_sp <- table(sp)
# min(tap_sp)
rare_n <- 11
# rafefact number of observations per species
# get randomly 11 observations per each species from dat
closest_10_dist <- sapply(1:10, function(i){
rarefied_xdist <- unlist(lapply(names(tap_sp), function(s){
s_dist <- xdist[sp == s]
if(length(s_dist) > rare_n){
s_dist <- sample(s_dist, rare_n)
}
return(s_dist)
})
)
out <- mean(sort(rarefied_xdist)[1:10])
return(out)
})
return(mean(closest_10_dist))
}))
library(ggplot2)
# boxplot de closest_10_dist por especie
ggplot(dat, aes(x = species, y = closest_10_dist)) +
geom_boxplot() +
theme_minimal() +
labs(title = "Distancia promedio a los 10 puntos más cercanos de otras especies",
x = "Especie",
y = "Distancia promedio a los 10 puntos más cercanos")
# boxplot de closest_10_dist por especie
ggplot(dat, aes(x = species, y = closest_10_dist)) +
geom_violin() +
theme_minimal() +
labs(title = "Distancia promedio a los 10 puntos más cercanos de otras especies",
x = "Especie",
y = "Distancia promedio a los 10 puntos más cercanos")
dat$phaeochroa <- ifelse(dat$species == "phaeochroa", "phaeochroa", "other_species")
ggplot(dat, aes(x = phaeochroa, y = closest_10_dist)) +
geom_violin() +
theme_minimal() +
labs(title = "Distancia promedio a los 10 puntos más cercanos de otras especies",
x = "Especie",
y = "Distancia promedio a los 10 puntos más cercanos")
dat$species
dat$phaeochroa <- ifelse(dat$species == "Phaeochroa_cuvierii", "phaeochroa", "other_species")
ggplot(dat, aes(x = phaeochroa, y = closest_10_dist)) +
geom_violin() +
theme_minimal() +
labs(title = "Distancia promedio a los 10 puntos más cercanos de otras especies",
x = "Especie",
y = "Distancia promedio a los 10 puntos más cercanos")
names(dat)
pair_dist <- dist(dat[, c("pca1", "pca2")])
class(pair_dist)
pair_dist_df <- as.matrix(pair_dist)
str(pair_dist_df)
pair_dist_df[1, 74]
all(diag(pair_dist_df == 0))
library(pbapply)
# calcular la distancia a los 10 puntos mas cercanos que no son de mi propia especie
rare_n <- 11
dat$closest_10_dist <-unlist(pblapply(1:nrow(pair_dist_df), function(x){
xdist <- pair_dist_df[x, ]
sp <- dat$species[dat$species != dat$species[x]]
xdist <- xdist[dat$species != dat$species[x]]
tap_sp <- table(sp)
# min(tap_sp)
rare_n <- 11
# rafefact number of observations per species
# get randomly 11 observations per each species from dat
closest_10_dist <- sapply(1:10, function(i){
rarefied_xdist <- unlist(lapply(names(tap_sp), function(s){
s_dist <- xdist[sp == s]
if(length(s_dist) > rare_n){
s_dist <- sample(s_dist, rare_n)
}
return(s_dist)
})
)
out <- mean(sort(rarefied_xdist)[1:10])
return(out)
})
return(mean(closest_10_dist))
}))
library(ggplot2)
# boxplot de closest_10_dist por especie
ggplot(dat, aes(x = species, y = closest_10_dist)) +
geom_violin() +
theme_minimal() +
labs(title = "Distancia promedio a los 10 puntos más cercanos de otras especies",
x = "Especie",
y = "Distancia promedio a los 10 puntos más cercanos")
# boxplot de closest_10_dist por especie
ggplot(dat, aes(x = species, y = closest_10_dist)) +
geom_violin() +
theme_minimal() +
labs(title = "Distancia promedio a los 10 puntos más cercanos de otras especies",
x = "Especie",
y = "Distancia promedio a los 10 puntos más cercanos") +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
dat$phaeochroa <- ifelse(dat$species == "Phaeochroa_cuvierii", "phaeochroa", "other_species")
ggplot(dat, aes(x = phaeochroa, y = closest_10_dist)) +
geom_violin() +
theme_minimal() +
labs(title = "Distancia promedio a los 10 puntos más cercanos de otras especies",
x = "Especie",
y = "Distancia promedio a los 10 puntos más cercanos")
# rafefact number of observations per species
# get randomly 11 observations per each species from dat
closest_10_dist <- sapply(1:10, function(i){
rarefied_xdist <- unlist(lapply(names(tap_sp), function(s){
s_dist <- xdist[sp == s]
if(length(s_dist) > rare_n){
s_dist <- sample(s_dist, rare_n)
}
return(s_dist)
})
)
out <- mean(sort(rarefied_xdist)[1:5])
return(out)
})
return(mean(closest_10_dist))
dat$closest_10_dist <-unlist(pblapply(1:nrow(pair_dist_df), function(x){
xdist <- pair_dist_df[x, ]
sp <- dat$species[dat$species != dat$species[x]]
xdist <- xdist[dat$species != dat$species[x]]
tap_sp <- table(sp)
# min(tap_sp)
rare_n <- 11
# rafefact number of observations per species
# get randomly 11 observations per each species from dat
closest_10_dist <- sapply(1:10, function(i){
rarefied_xdist <- unlist(lapply(names(tap_sp), function(s){
s_dist <- xdist[sp == s]
if(length(s_dist) > rare_n){
s_dist <- sample(s_dist, rare_n)
}
return(s_dist)
})
)
out <- mean(sort(rarefied_xdist)[1:5])
return(out)
})
return(mean(closest_10_dist))
}))
# boxplot de closest_10_dist por especie
ggplot(dat, aes(x = species, y = closest_10_dist)) +
geom_violin() +
theme_minimal() +
labs(title = "Distancia promedio a los 10 puntos más cercanos de otras especies",
x = "Especie",
y = "Distancia promedio a los 10 puntos más cercanos") +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
dat$phaeochroa <- ifelse(dat$species == "Phaeochroa_cuvierii", "phaeochroa", "other_species")
ggplot(dat, aes(x = phaeochroa, y = closest_10_dist)) +
geom_violin() +
theme_minimal() +
labs(title = "Distancia promedio a los 10 puntos más cercanos de otras especies",
x = "Especie",
y = "Distancia promedio a los 10 puntos más cercanos")
dat$closest_10_dist <-unlist(pblapply(1:nrow(pair_dist_df), function(x){
xdist <- pair_dist_df[x, ]
sp <- dat$species[!dat$species %in% c(dat$species[x], "Phaeochroa_cuvierii")]
xdist <- xdist[!dat$species %in% c(dat$species[x], "Phaeochroa_cuvierii")]
tap_sp <- table(sp)
# min(tap_sp)
rare_n <- 11
# rafefact number of observations per species
# get randomly 11 observations per each species from dat
closest_10_dist <- sapply(1:10, function(i){
rarefied_xdist <- unlist(lapply(names(tap_sp), function(s){
s_dist <- xdist[sp == s]
if(length(s_dist) > rare_n){
s_dist <- sample(s_dist, rare_n)
}
return(s_dist)
})
)
out <- mean(sort(rarefied_xdist)[1:5])
return(out)
})
return(mean(closest_10_dist))
}))
library(ggplot2)
# boxplot de closest_10_dist por especie
ggplot(dat, aes(x = species, y = closest_10_dist)) +
geom_violin() +
theme_minimal() +
labs(title = "Distancia promedio a los 10 puntos más cercanos de otras especies",
x = "Especie",
y = "Distancia promedio a los 10 puntos más cercanos") +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
dat$phaeochroa <- ifelse(dat$species == "Phaeochroa_cuvierii", "phaeochroa", "other_species")
ggplot(dat, aes(x = phaeochroa, y = closest_10_dist)) +
geom_violin() +
theme_minimal() +
labs(title = "Distancia promedio a los 10 puntos más cercanos de otras especies",
x = "Especie",
y = "Distancia promedio a los 10 puntos más cercanos")
dat$closest_10_dist <-unlist(pblapply(1:nrow(pair_dist_df), function(x){
xdist <- pair_dist_df[x, ]
sp <- dat$species[!dat$species %in% c(dat$species[x], "Phaeochroa_cuvierii")]
xdist <- xdist[!dat$species %in% c(dat$species[x], "Phaeochroa_cuvierii")]
# min(tap_sp)
rare_n <- 11
# rafefact number of observations per species
# get randomly 11 observations per each species from dat
closest_10_dist <- sapply(1:10, function(i){
rarefied_xdist <- unlist(lapply(unique(sp), function(s){
s_dist <- xdist[sp == s]
if(length(s_dist) > rare_n){
s_dist <- sample(s_dist, rare_n)
}
return(s_dist)
})
)
out <- mean(sort(rarefied_xdist)[1:5])
return(out)
})
return(mean(closest_10_dist))
}))
library(ggplot2)
# boxplot de closest_10_dist por especie
ggplot(dat, aes(x = species, y = closest_10_dist)) +
geom_violin() +
theme_minimal() +
labs(title = "Distancia promedio a los 10 puntos más cercanos de otras especies",
x = "Especie",
y = "Distancia promedio a los 10 puntos más cercanos") +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
dat$phaeochroa <- ifelse(dat$species == "Phaeochroa_cuvierii", "phaeochroa", "other_species")
ggplot(dat, aes(x = phaeochroa, y = closest_10_dist)) +
geom_violin() +
theme_minimal() +
labs(title = "Distancia promedio a los 10 puntos más cercanos de otras especies",
x = "Especie",
y = "Distancia promedio a los 10 puntos más cercanos")
ggplot(dat, aes(x = phaeochroa, y = closest_10_dist)) +
geom_violin() +
geom_boxplot(width = 0.1, fill = "white", outlier.shape = NA) +
theme_minimal() +
labs(title = "Distancia promedio a los 10 puntos más cercanos de otras especies",
x = "Especie",
y = "Distancia promedio a los 10 puntos más cercanos")
dat$closest_10_dist <- unlist(pblapply(1:nrow(pair_dist_df), cl = 3, function(x){
xdist <- pair_dist_df[x, ]
sp <- dat$species[!dat$species %in% c(dat$species[x], "Phaeochroa_cuvierii")]
xdist <- xdist[!dat$species %in% c(dat$species[x], "Phaeochroa_cuvierii")]
# min(tap_sp)
rare_n <- 11
# rafefact number of observations per species
# get randomly 11 observations per each species from dat
closest_10_dist <- sapply(1:100, function(i){
rarefied_xdist <- unlist(lapply(unique(sp), function(s){
s_dist <- xdist[sp == s]
if(length(s_dist) > rare_n){
s_dist <- sample(s_dist, rare_n)
}
return(s_dist)
})
)
out <- mean(sort(rarefied_xdist)[1:15])
return(out)
})
return(mean(closest_10_dist))
}))
library(ggplot2)
# boxplot de closest_10_dist por especie
ggplot(dat, aes(x = species, y = closest_10_dist)) +
geom_violin() +
theme_minimal() +
labs(title = "Distancia promedio a los 10 puntos más cercanos de otras especies",
x = "Especie",
y = "Distancia promedio a los 10 puntos más cercanos") +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
dat$phaeochroa <- ifelse(dat$species == "Phaeochroa_cuvierii", "phaeochroa", "other_species")
ggplot(dat, aes(x = phaeochroa, y = closest_10_dist)) +
geom_violin() +
geom_boxplot(width = 0.1, fill = "white", outlier.shape = NA) +
theme_minimal() +
labs(title = "Distancia promedio a los 10 puntos más cercanos de otras especies",
x = "Especie",
y = "Distancia promedio a los 10 puntos más cercanos")
