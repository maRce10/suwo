kableExtra::kbl(
caption =
"Table 1: Summary of query functions and the associated repositories.",
format = "html",
escape = FALSE,
row.names = FALSE
) |>
kableExtra::kable_styling(
bootstrap_options = c("striped", "hover", "condensed", "responsive"),
full_width = FALSE,
position = "left"
)
?knitr::kable()
install.packages("revgeo")
h_peckii <- query_inaturalist(species = 'Hydnellum peckii', format = "image")
h_peckii$country
lintr::lint_package(linters =  list(lintr::line_length_linter()))
query_summary$Repository
The [suwo](https://marce10.github.io/suwo/) package aims to simplify the
dat <- read.csv("~/Descargas/clusters_with_umap_centroid_assignment.csv")
head(dat)
str(dat)
pair_dist <- dist(dat[, c("umap1", "umap2")])
class(pair_dist)
pair_dist_df <- as.matrix(pair_dist)
str(pair_dist_df)
pair_dist_df[1, 74]
all(diag(pair_dist_df == 0))
library(pbapply)
dat$closest_10_dist <-unlist(pblapply(1:nrow(pair_dist_df), function(x){
xdist <- pair_dist_df[x, ]
xdist <- xdist[dat$species != dat$species[x]]
closest_10_dist <- mean(sort(xdist)[1:10])
return(closest_10_dist)
})
)
library(ggplot2)
# boxplot de closest_10_dist por especie
ggplot(dat, aes(x = species, y = closest_10_dist)) +
geom_boxplot() +
theme_minimal() +
labs(title = "Distancia promedio a los 10 puntos más cercanos de otras especies",
x = "Especie",
y = "Distancia promedio a los 10 puntos más cercanos")
x = 1
xdist <- pair_dist_df[x, ]
sp <- dat$species[dat$species != dat$species[x]]
xdist <- xdist[dat$species != dat$species[x]]
sp
table(sp)
tap_sp <- table(sp)
min(tap_sp)
table(dat$species)
i <- 1
rarefied_xdist <- unlist(lapply(names(tap_sp), function(s){
s_dist <- xdist[sp == s]
if(length(s_dist) > rare_n){
s_dist <- sample(s_dist, rare_n)
}
return(s_dist)
}))
rare_n <- 11
rarefied_xdist <- unlist(lapply(names(tap_sp), function(s){
s_dist <- xdist[sp == s]
if(length(s_dist) > rare_n){
s_dist <- sample(s_dist, rare_n)
}
return(s_dist)
}))
rarefied_xdist
rarefied_xdist <- unlist(lapply(names(tap_sp), function(s){
s_dist <- xdist[sp == s]
if(length(s_dist) > rare_n){
s_dist <- sample(s_dist, rare_n)
}
return(s_dist)
closest_10_dist <- mean(sort(xdist)[1:10])
}))
rarefied_xdist
rarefied_xdist <- unlist(lapply(names(tap_sp), function(s){
s_dist <- xdist[sp == s]
if(length(s_dist) > rare_n){
s_dist <- sample(s_dist, rare_n)
}
return(s_dist)
}))
rarefied_xdist
length(rarefied_xdist)
names(tap_sp)
14 *11
rarefied_xdist
closest_10_dist <- mean(sort(rarefied_xdist)[1:10])
closest_10_dist
# rafefact number of observations per species
# get randomly 11 observations per each species from dat
closest_10_dist <- sapply(1:100, function(i){
rarefied_xdist <- unlist(lapply(names(tap_sp), function(s){
s_dist <- xdist[sp == s]
if(length(s_dist) > rare_n){
s_dist <- sample(s_dist, rare_n)
}
return(s_dist)
})
)
out <- mean(sort(rarefied_xdist)[1:10])
return(out)
})
dat$closest_10_dist <-unlist(pblapply(1:nrow(pair_dist_df), function(x){
dat$closest_10_dist <-unlist(pblapply(1:nrow(pair_dist_df), function(x){
xdist <- pair_dist_df[x, ]
sp <- dat$species[dat$species != dat$species[x]]
xdist <- xdist[dat$species != dat$species[x]]
tap_sp <- table(sp)
# min(tap_sp)
rare_n <- 11
# rafefact number of observations per species
# get randomly 11 observations per each species from dat
closest_10_dist <- sapply(1:10, function(i){
rarefied_xdist <- unlist(lapply(names(tap_sp), function(s){
s_dist <- xdist[sp == s]
if(length(s_dist) > rare_n){
s_dist <- sample(s_dist, rare_n)
}
return(s_dist)
})
)
out <- mean(sort(rarefied_xdist)[1:10])
return(out)
})
return(mean(closest_10_dist))
}))
library(ggplot2)
# boxplot de closest_10_dist por especie
ggplot(dat, aes(x = species, y = closest_10_dist)) +
geom_boxplot() +
theme_minimal() +
labs(title = "Distancia promedio a los 10 puntos más cercanos de otras especies",
x = "Especie",
y = "Distancia promedio a los 10 puntos más cercanos")
# boxplot de closest_10_dist por especie
ggplot(dat, aes(x = species, y = closest_10_dist)) +
geom_violin() +
theme_minimal() +
labs(title = "Distancia promedio a los 10 puntos más cercanos de otras especies",
x = "Especie",
y = "Distancia promedio a los 10 puntos más cercanos")
dat$phaeochroa <- ifelse(dat$species == "phaeochroa", "phaeochroa", "other_species")
ggplot(dat, aes(x = phaeochroa, y = closest_10_dist)) +
geom_violin() +
theme_minimal() +
labs(title = "Distancia promedio a los 10 puntos más cercanos de otras especies",
x = "Especie",
y = "Distancia promedio a los 10 puntos más cercanos")
dat$species
dat$phaeochroa <- ifelse(dat$species == "Phaeochroa_cuvierii", "phaeochroa", "other_species")
ggplot(dat, aes(x = phaeochroa, y = closest_10_dist)) +
geom_violin() +
theme_minimal() +
labs(title = "Distancia promedio a los 10 puntos más cercanos de otras especies",
x = "Especie",
y = "Distancia promedio a los 10 puntos más cercanos")
names(dat)
pair_dist <- dist(dat[, c("pca1", "pca2")])
class(pair_dist)
pair_dist_df <- as.matrix(pair_dist)
str(pair_dist_df)
pair_dist_df[1, 74]
all(diag(pair_dist_df == 0))
library(pbapply)
# calcular la distancia a los 10 puntos mas cercanos que no son de mi propia especie
rare_n <- 11
dat$closest_10_dist <-unlist(pblapply(1:nrow(pair_dist_df), function(x){
xdist <- pair_dist_df[x, ]
sp <- dat$species[dat$species != dat$species[x]]
xdist <- xdist[dat$species != dat$species[x]]
tap_sp <- table(sp)
# min(tap_sp)
rare_n <- 11
# rafefact number of observations per species
# get randomly 11 observations per each species from dat
closest_10_dist <- sapply(1:10, function(i){
rarefied_xdist <- unlist(lapply(names(tap_sp), function(s){
s_dist <- xdist[sp == s]
if(length(s_dist) > rare_n){
s_dist <- sample(s_dist, rare_n)
}
return(s_dist)
})
)
out <- mean(sort(rarefied_xdist)[1:10])
return(out)
})
return(mean(closest_10_dist))
}))
library(ggplot2)
# boxplot de closest_10_dist por especie
ggplot(dat, aes(x = species, y = closest_10_dist)) +
geom_violin() +
theme_minimal() +
labs(title = "Distancia promedio a los 10 puntos más cercanos de otras especies",
x = "Especie",
y = "Distancia promedio a los 10 puntos más cercanos")
# boxplot de closest_10_dist por especie
ggplot(dat, aes(x = species, y = closest_10_dist)) +
geom_violin() +
theme_minimal() +
labs(title = "Distancia promedio a los 10 puntos más cercanos de otras especies",
x = "Especie",
y = "Distancia promedio a los 10 puntos más cercanos") +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
dat$phaeochroa <- ifelse(dat$species == "Phaeochroa_cuvierii", "phaeochroa", "other_species")
ggplot(dat, aes(x = phaeochroa, y = closest_10_dist)) +
geom_violin() +
theme_minimal() +
labs(title = "Distancia promedio a los 10 puntos más cercanos de otras especies",
x = "Especie",
y = "Distancia promedio a los 10 puntos más cercanos")
# rafefact number of observations per species
# get randomly 11 observations per each species from dat
closest_10_dist <- sapply(1:10, function(i){
rarefied_xdist <- unlist(lapply(names(tap_sp), function(s){
s_dist <- xdist[sp == s]
if(length(s_dist) > rare_n){
s_dist <- sample(s_dist, rare_n)
}
return(s_dist)
})
)
out <- mean(sort(rarefied_xdist)[1:5])
return(out)
})
return(mean(closest_10_dist))
dat$closest_10_dist <-unlist(pblapply(1:nrow(pair_dist_df), function(x){
xdist <- pair_dist_df[x, ]
sp <- dat$species[dat$species != dat$species[x]]
xdist <- xdist[dat$species != dat$species[x]]
tap_sp <- table(sp)
# min(tap_sp)
rare_n <- 11
# rafefact number of observations per species
# get randomly 11 observations per each species from dat
closest_10_dist <- sapply(1:10, function(i){
rarefied_xdist <- unlist(lapply(names(tap_sp), function(s){
s_dist <- xdist[sp == s]
if(length(s_dist) > rare_n){
s_dist <- sample(s_dist, rare_n)
}
return(s_dist)
})
)
out <- mean(sort(rarefied_xdist)[1:5])
return(out)
})
return(mean(closest_10_dist))
}))
# boxplot de closest_10_dist por especie
ggplot(dat, aes(x = species, y = closest_10_dist)) +
geom_violin() +
theme_minimal() +
labs(title = "Distancia promedio a los 10 puntos más cercanos de otras especies",
x = "Especie",
y = "Distancia promedio a los 10 puntos más cercanos") +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
dat$phaeochroa <- ifelse(dat$species == "Phaeochroa_cuvierii", "phaeochroa", "other_species")
ggplot(dat, aes(x = phaeochroa, y = closest_10_dist)) +
geom_violin() +
theme_minimal() +
labs(title = "Distancia promedio a los 10 puntos más cercanos de otras especies",
x = "Especie",
y = "Distancia promedio a los 10 puntos más cercanos")
dat$closest_10_dist <-unlist(pblapply(1:nrow(pair_dist_df), function(x){
xdist <- pair_dist_df[x, ]
sp <- dat$species[!dat$species %in% c(dat$species[x], "Phaeochroa_cuvierii")]
xdist <- xdist[!dat$species %in% c(dat$species[x], "Phaeochroa_cuvierii")]
tap_sp <- table(sp)
# min(tap_sp)
rare_n <- 11
# rafefact number of observations per species
# get randomly 11 observations per each species from dat
closest_10_dist <- sapply(1:10, function(i){
rarefied_xdist <- unlist(lapply(names(tap_sp), function(s){
s_dist <- xdist[sp == s]
if(length(s_dist) > rare_n){
s_dist <- sample(s_dist, rare_n)
}
return(s_dist)
})
)
out <- mean(sort(rarefied_xdist)[1:5])
return(out)
})
return(mean(closest_10_dist))
}))
library(ggplot2)
# boxplot de closest_10_dist por especie
ggplot(dat, aes(x = species, y = closest_10_dist)) +
geom_violin() +
theme_minimal() +
labs(title = "Distancia promedio a los 10 puntos más cercanos de otras especies",
x = "Especie",
y = "Distancia promedio a los 10 puntos más cercanos") +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
dat$phaeochroa <- ifelse(dat$species == "Phaeochroa_cuvierii", "phaeochroa", "other_species")
ggplot(dat, aes(x = phaeochroa, y = closest_10_dist)) +
geom_violin() +
theme_minimal() +
labs(title = "Distancia promedio a los 10 puntos más cercanos de otras especies",
x = "Especie",
y = "Distancia promedio a los 10 puntos más cercanos")
dat$closest_10_dist <-unlist(pblapply(1:nrow(pair_dist_df), function(x){
xdist <- pair_dist_df[x, ]
sp <- dat$species[!dat$species %in% c(dat$species[x], "Phaeochroa_cuvierii")]
xdist <- xdist[!dat$species %in% c(dat$species[x], "Phaeochroa_cuvierii")]
# min(tap_sp)
rare_n <- 11
# rafefact number of observations per species
# get randomly 11 observations per each species from dat
closest_10_dist <- sapply(1:10, function(i){
rarefied_xdist <- unlist(lapply(unique(sp), function(s){
s_dist <- xdist[sp == s]
if(length(s_dist) > rare_n){
s_dist <- sample(s_dist, rare_n)
}
return(s_dist)
})
)
out <- mean(sort(rarefied_xdist)[1:5])
return(out)
})
return(mean(closest_10_dist))
}))
library(ggplot2)
# boxplot de closest_10_dist por especie
ggplot(dat, aes(x = species, y = closest_10_dist)) +
geom_violin() +
theme_minimal() +
labs(title = "Distancia promedio a los 10 puntos más cercanos de otras especies",
x = "Especie",
y = "Distancia promedio a los 10 puntos más cercanos") +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
dat$phaeochroa <- ifelse(dat$species == "Phaeochroa_cuvierii", "phaeochroa", "other_species")
ggplot(dat, aes(x = phaeochroa, y = closest_10_dist)) +
geom_violin() +
theme_minimal() +
labs(title = "Distancia promedio a los 10 puntos más cercanos de otras especies",
x = "Especie",
y = "Distancia promedio a los 10 puntos más cercanos")
ggplot(dat, aes(x = phaeochroa, y = closest_10_dist)) +
geom_violin() +
geom_boxplot(width = 0.1, fill = "white", outlier.shape = NA) +
theme_minimal() +
labs(title = "Distancia promedio a los 10 puntos más cercanos de otras especies",
x = "Especie",
y = "Distancia promedio a los 10 puntos más cercanos")
dat$closest_10_dist <- unlist(pblapply(1:nrow(pair_dist_df), cl = 3, function(x){
xdist <- pair_dist_df[x, ]
sp <- dat$species[!dat$species %in% c(dat$species[x], "Phaeochroa_cuvierii")]
xdist <- xdist[!dat$species %in% c(dat$species[x], "Phaeochroa_cuvierii")]
# min(tap_sp)
rare_n <- 11
# rafefact number of observations per species
# get randomly 11 observations per each species from dat
closest_10_dist <- sapply(1:100, function(i){
rarefied_xdist <- unlist(lapply(unique(sp), function(s){
s_dist <- xdist[sp == s]
if(length(s_dist) > rare_n){
s_dist <- sample(s_dist, rare_n)
}
return(s_dist)
})
)
out <- mean(sort(rarefied_xdist)[1:15])
return(out)
})
return(mean(closest_10_dist))
}))
library(ggplot2)
# boxplot de closest_10_dist por especie
ggplot(dat, aes(x = species, y = closest_10_dist)) +
geom_violin() +
theme_minimal() +
labs(title = "Distancia promedio a los 10 puntos más cercanos de otras especies",
x = "Especie",
y = "Distancia promedio a los 10 puntos más cercanos") +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
dat$phaeochroa <- ifelse(dat$species == "Phaeochroa_cuvierii", "phaeochroa", "other_species")
ggplot(dat, aes(x = phaeochroa, y = closest_10_dist)) +
geom_violin() +
geom_boxplot(width = 0.1, fill = "white", outlier.shape = NA) +
theme_minimal() +
labs(title = "Distancia promedio a los 10 puntos más cercanos de otras especies",
x = "Especie",
y = "Distancia promedio a los 10 puntos más cercanos")
## date ranges
test_that(".date_ranges", {
dts <- suwo:::.date_ranges(x = c(1976, 2020, 2022, 2024, 2025, 2026))
# test
expect_true(nrow(dts) == 5)
dts <- suwo:::.date_ranges(x = seq(1976, 2026, length.out = 50))
expect_true(nrow(dts) == 94)
})
library(testthat)
## date ranges
test_that(".date_ranges", {
dts <- suwo:::.date_ranges(x = c(1976, 2020, 2022, 2024, 2025, 2026))
# test
expect_true(nrow(dts) == 5)
dts <- suwo:::.date_ranges(x = seq(1976, 2026, length.out = 50))
expect_true(nrow(dts) == 94)
})
dts <- suwo:::.date_ranges(x = c(1976, 2020, 2022, 2024, 2025, 2026))
nrow(dts)
dts <- suwo:::.date_ranges(x = seq(1976, 2026, length.out = 50))
dts
nrow(dts)
nrow(dts)
nrow(dts)
nrow(dts)
## date ranges
test_that(".date_ranges", {
dts <- suwo:::.date_ranges(x = c(1976, 2020, 2022, 2024, 2025, 2026))
# test
expect_true(nrow(dts) == 5)
dts <- suwo:::.date_ranges(x = seq(1976, 2026, length.out = 50))
expect_true(nrow(dts) == 95)
})
test_that(".onLoad", {
dts <- try(suwo:::.onLoad(), silent = TRUE)
expect_true(is(dts, "try-error"))
})
test_that(".onUnload", {
dts <- try(suwo:::.onUnload(), silent = TRUE)
expect_true(is.null(dts))
})
test_that(".add_emoji", {
em <- suwo:::.add_emoji("happy")
expect_true(class(em) == "character")
})
test_that(".monitor_new_files", {
out <-suwo:::.monitor_new_files(path = tempdir(), break.time = 0.0001)
expect_true(is.null(out))
})
test_that(".repo_from_call handles namespaced calls", {
skip_on_cran()
skip_if_offline()
# construct call objects
call_non_ns <- quote(query_gbif(species = 'Aristolochia baetica',
format =  "image"))
call_ns <- quote(suwo::query_gbif(species = 'Aristolochia baetica',
format =  "image"))
# call the internal function using the namespace
f <- suwo:::.repo_from_call
expect_identical(
f(call_non_ns),
"GBIF"
)
expect_identical(
f(call_ns),
"GBIF"
)
})
if (!nzchar(Sys.getenv("XENO_CANTO_API_KEY")))
Sys.setenv(XENO_CANTO_API_KEY = getPass::getPass())
devtools::document(".")
devtools::check(document = TRUE, run_dont_test = TRUE, vignettes = TRUE, manual = TRUE)
suwo:::merged_metadata
dir.create(tempdir())
dir.create(file.path(tempdir(),"download"))
dm <- download_media(suwo:::merged_metadata, path = file.path(tempdir(),"daownload"))
suwo:::merged_metadata$repository
dm <- download_media(suwo:::merged_metadata, path = file.path(tempdir(),"daownload"), folder_by = "repository")
dm <- download_media(suwo:::merged_metadata, path = file.path(tempdir(),"dawnload"), folder_by = "repository")
dm <- download_media(suwo:::merged_metadata, path = file.path(tempdir(),"download"), folder_by = "repository")
table(dm$download_status)
dm2 <- download_media(suwo:::merged_metadata, path = file.path(tempdir(),"download"), folder_by = "repository")
dm2
table(dm2$download_status)
options(verbose = T)
dm2 <- download_media(suwo:::merged_metadata, path = file.path(tempdir(),"download"), folder_by = "repository")
dm2[dm2$download_status == "failed", ]
dm2 <- download_media(suwo:::merged_metadata, path = file.path(tempdir(),"download"), folder_by = "repository")
table(dm2$download_status)
(3/2321)*100
devtools::document(".")
devtools::document(".")
devtools::document(".")
devtools::document(".")
devtools::document(".")
rlang::last_trace()
rlang::last_trace()
devtools::document(".")
devtools::document(".")
devtools::document(".")
devtools::document(".")
devtools::document(".")
devtools::document(".")
devtools::document(".")
devtools::document(".")
devtools::document(".")\
devtools::document(".")
if (!nzchar(Sys.getenv("XENO_CANTO_API_KEY")))
Sys.setenv(XENO_CANTO_API_KEY = getPass::getPass())
devtools::document(".")
devtools::check(document = TRUE, run_dont_test = TRUE, vignettes = TRUE, manual = TRUE)
tools::checkRd(dir = "man/")
tools::checkRdContents()
tools::checkRdContents(dir = "/man")
tools::checkRdContents(dir = "./man")
getwd()
devtools::check_man()
devtools::document(".")
devtools::check_man()
