skip_on_cran()
skip_if_offline()
df1 <- query_wikiaves(species = 'Glaucis dohrnii', format =  "image",
all_data = FALSE)
skip_if(is.null(df1))
expected_col_names <- .format_query_output(only_basic_columns = T)
query_col_names <- colnames(df1)
expect_true(all(query_col_names %in% expected_col_names) &
all(expected_col_names %in% query_col_names),
info = "Column names do not match the expected names")
})
is_error(query_output)
rlang::is_error(query_output)
rlang::is_error(essdf())
rlang::is_error(try(essdf()))
rlang::is_error(try(essdf(), silent = T))
(try(essdf(), silent = T))
# get if an object is an error from try()
.is_error <- function(x){
is(x, "try-error")
}
source("~/Dropbox/R_package_testing/suwo/R/query_xenocanto.R")
run.all()
test_that("search Phaethornis check rows", {
skip_on_cran()
skip_if_offline()
skip_if(!nzchar(Sys.getenv("XENO_CANTO_API_KEY")),
"Xeno-Canto API key not set")
df1 <- query_xenocanto(
species = 'Phaethornis anthophilus',
all_data = FALSE,
api_key = Sys.getenv("XENO_CANTO_API_KEY")
)
expect_true(nrow(df1) > 15)
expect_true(ncol(df1) == length(.format_query_output(only_basic_columns = T)))
})
test_that("all data TRUE", {
skip_on_cran()
skip_if_offline()
skip_if(!nzchar(Sys.getenv("XENO_CANTO_API_KEY")),
"Xeno-Canto API key not set")
df1 <- query_xenocanto(
species = 'Phaethornis anthophilus',
all_data = TRUE,
api_key = Sys.getenv("XENO_CANTO_API_KEY")
)
expect_true(nrow(df1) >= 15)
})
test_that("no recs found", {
skip_on_cran()
skip_if_offline()
skip_if(!nzchar(Sys.getenv("XENO_CANTO_API_KEY")),
"Xeno-Canto API key not set")
df1 <- query_xenocanto(species = '000',
api_key = Sys.getenv("XENO_CANTO_API_KEY"))
expect_true(is.null(df1))
})
test_that("check messages", {
skip_on_cran()
skip_if_offline()
skip_if(!nzchar(Sys.getenv("XENO_CANTO_API_KEY")),
"Xeno-Canto API key not set")
msg <- capture_error(
query_xenocanto(species = '000', verbose = TRUE,
api_key = "")
)
expect_true(as.character(msg) ==
paste("Error: An API key is required for Xeno-Canto API v3.",
"Get yours at https://xeno-canto.org/account.\n"))
msg <- capture.output(
a <- query_xenocanto(species = '000', verbose = FALSE,
api_key = Sys.getenv("XENO_CANTO_API_KEY"))
)
expect_true(length(msg) == 0)
msg <- capture.output(
a <- query_xenocanto(
species = 'Phaethornis anthophilus',
verbose = TRUE,
pb = FALSE,
api_key = Sys.getenv("XENO_CANTO_API_KEY")
)
)
expect_true(length(msg) == 0)
})
test_that("test all_data FALSE", {
skip_on_cran()
skip_if_offline()
skip_if(!nzchar(Sys.getenv("XENO_CANTO_API_KEY")),
"Xeno-Canto API key not set")
df1 <- query_xenocanto(
species = 'Phaethornis anthophilus',
all_data = FALSE,
api_key = Sys.getenv("XENO_CANTO_API_KEY")
)
expected_col_names <- .format_query_output(only_basic_columns = TRUE)
query_col_names <- colnames(df1)
expect_true(all(expected_col_names %in% query_col_names) &&
all(query_col_names %in% expected_col_names),
info = "Column names do not match the expected names")
})
test_that("test raw_data TRUE", {
skip_on_cran()
skip_if_offline()
skip_if(!nzchar(Sys.getenv("XENO_CANTO_API_KEY")),
"Xeno-Canto API key not set")
df1 <- query_xenocanto(
species = 'Phaethornis anthophilus',
raw_data = TRUE,
api_key = Sys.getenv("XENO_CANTO_API_KEY")
)
expect_true(ncol(df1) == 45)
})
test_that("test tags", {
skip_on_cran()
skip_if_offline()
skip_if(!nzchar(Sys.getenv("XENO_CANTO_API_KEY")),
"Xeno-Canto API key not set")
df1 <- query_xenocanto(
species = 'sp:"Phaethornis anthophilus" cnt:"Panama"',
raw_data = TRUE,
api_key = Sys.getenv("XENO_CANTO_API_KEY")
)
expect_true(nrow(df1) > 1)
femsong <- query_xenocanto(
species = 'sp:"Thryothorus ludovicianus" type:"song" type:"female"',
api_key = Sys.getenv("XENO_CANTO_API_KEY"))
expect_true(nrow(femsong) > 490)
})
## set XC Key
Sys.setenv(XENO_CANTO_API_KEY = getPass::getPass())
test_that("search Phaethornis check rows", {
skip_on_cran()
skip_if_offline()
skip_if(!nzchar(Sys.getenv("XENO_CANTO_API_KEY")),
"Xeno-Canto API key not set")
df1 <- query_xenocanto(
species = 'Phaethornis anthophilus',
all_data = FALSE,
api_key = Sys.getenv("XENO_CANTO_API_KEY")
)
expect_true(nrow(df1) > 15)
expect_true(ncol(df1) == length(.format_query_output(only_basic_columns = T)))
})
skip_on_cran()
skip_if_offline()
skip_if(!nzchar(Sys.getenv("XENO_CANTO_API_KEY")),
"Xeno-Canto API key not set")
df1 <- query_xenocanto(
species = 'Phaethornis anthophilus',
all_data = FALSE,
api_key = Sys.getenv("XENO_CANTO_API_KEY")
)
source("~/Dropbox/R_package_testing/suwo/R/query_xenocanto.R")
source("~/Dropbox/R_package_testing/suwo/R/query_xenocanto.R")
source("~/Dropbox/R_package_testing/suwo/R/query_xenocanto.R")
test_that("search Phaethornis check rows", {
skip_on_cran()
skip_if_offline()
skip_if(!nzchar(Sys.getenv("XENO_CANTO_API_KEY")),
"Xeno-Canto API key not set")
df1 <- query_xenocanto(
species = 'Phaethornis anthophilus',
all_data = FALSE,
api_key = Sys.getenv("XENO_CANTO_API_KEY")
)
expect_true(nrow(df1) > 15)
expect_true(ncol(df1) == length(.format_query_output(only_basic_columns = T)))
})
test_that("all data TRUE", {
skip_on_cran()
skip_if_offline()
skip_if(!nzchar(Sys.getenv("XENO_CANTO_API_KEY")),
"Xeno-Canto API key not set")
df1 <- query_xenocanto(
species = 'Phaethornis anthophilus',
all_data = TRUE,
api_key = Sys.getenv("XENO_CANTO_API_KEY")
)
expect_true(nrow(df1) >= 15)
})
test_that("no recs found", {
skip_on_cran()
skip_if_offline()
skip_if(!nzchar(Sys.getenv("XENO_CANTO_API_KEY")),
"Xeno-Canto API key not set")
df1 <- query_xenocanto(species = '000',
api_key = Sys.getenv("XENO_CANTO_API_KEY"))
expect_true(is.null(df1))
})
test_that("check messages", {
skip_on_cran()
skip_if_offline()
skip_if(!nzchar(Sys.getenv("XENO_CANTO_API_KEY")),
"Xeno-Canto API key not set")
msg <- capture_error(
query_xenocanto(species = '000', verbose = TRUE,
api_key = "")
)
expect_true(as.character(msg) ==
paste("Error: An API key is required for Xeno-Canto API v3.",
"Get yours at https://xeno-canto.org/account.\n"))
msg <- capture.output(
a <- query_xenocanto(species = '000', verbose = FALSE,
api_key = Sys.getenv("XENO_CANTO_API_KEY"))
)
expect_true(length(msg) == 0)
msg <- capture.output(
a <- query_xenocanto(
species = 'Phaethornis anthophilus',
verbose = TRUE,
pb = FALSE,
api_key = Sys.getenv("XENO_CANTO_API_KEY")
)
)
expect_true(length(msg) == 0)
})
test_that("test all_data FALSE", {
skip_on_cran()
skip_if_offline()
skip_if(!nzchar(Sys.getenv("XENO_CANTO_API_KEY")),
"Xeno-Canto API key not set")
df1 <- query_xenocanto(
species = 'Phaethornis anthophilus',
all_data = FALSE,
api_key = Sys.getenv("XENO_CANTO_API_KEY")
)
expected_col_names <- .format_query_output(only_basic_columns = TRUE)
query_col_names <- colnames(df1)
expect_true(all(expected_col_names %in% query_col_names) &&
all(query_col_names %in% expected_col_names),
info = "Column names do not match the expected names")
})
test_that("test raw_data TRUE", {
skip_on_cran()
skip_if_offline()
skip_if(!nzchar(Sys.getenv("XENO_CANTO_API_KEY")),
"Xeno-Canto API key not set")
df1 <- query_xenocanto(
species = 'Phaethornis anthophilus',
raw_data = TRUE,
api_key = Sys.getenv("XENO_CANTO_API_KEY")
)
expect_true(ncol(df1) == 45)
})
test_that("test tags", {
skip_on_cran()
skip_if_offline()
skip_if(!nzchar(Sys.getenv("XENO_CANTO_API_KEY")),
"Xeno-Canto API key not set")
df1 <- query_xenocanto(
species = 'sp:"Phaethornis anthophilus" cnt:"Panama"',
raw_data = TRUE,
api_key = Sys.getenv("XENO_CANTO_API_KEY")
)
expect_true(nrow(df1) > 1)
femsong <- query_xenocanto(
species = 'sp:"Thryothorus ludovicianus" type:"song" type:"female"',
api_key = Sys.getenv("XENO_CANTO_API_KEY"))
expect_true(nrow(femsong) > 490)
})
df1 <- query_xenocanto(
species = 'Phaethornis anthophilus',
all_data = FALSE,
api_key = Sys.getenv("XENO_CANTO_API_KEY")
)
df2 <- df1
source("~/Dropbox/R_package_testing/suwo/R/query_xenocanto.R")
df1 <- query_xenocanto(
species = 'Phaethornis anthophilus',
all_data = FALSE,
api_key = Sys.getenv("XENO_CANTO_API_KEY")
)
nrow(df1)
nrow(df2)
head(df1)
head(df2)
#run document twice
devtools::document(".")
devtools::check(document = TRUE, run_dont_test = TRUE, vignettes = FALSE, manual = TRUE)
x <- GET("http://httpbin.org/status/404")
library(hhtr)
library(httr)
x <- GET("http://httpbin.org/status/404")
stop_for_status(x)
warn_for_status(x)
status(x)
httr::http_status(x)
httr::http_statusx <- GET("http://httpbin.org/status/200")
x <- GET("http://httpbin.org/status/200")
http_status(x)
http_status(GET("http://httpbin.org/status/300"))
http_status(GET("http://httpbin.org/status/301"))
http_status(GET("http://httpbin.org/status/404"))
tmp <- suwo::query_xenocanto(species = "Zonotrichia capensis",
api_key = Sys.getenv("XENO_CANTO_API_KEY"))
# initialize search with user agent
response <- httr::GET(
url = paste0(
"https://www.wikiaves.com.br/gedtTaxonsJSON.php?term=",
gsub(" ", "%20", species)
),
httr::user_agent("suwo (https://github.com/maRce10/suwo)")
)
response
httr::http_status(response)
# check if request succeeded
httr::http_status(response)
.message(
text = paste0(
"Wikiaves request failed: ",
httr::http_status(response)$message
),
as = "failure"
)
source("~/Dropbox/R_package_testing/suwo/R/query_wikiaves.R")
source("~/Dropbox/R_package_testing/suwo/R/query_wikiaves.R")
devtools::document(".")
devtools::check(document = TRUE, run_dont_test = TRUE, vignettes = FALSE, manual = TRUE)
df1 <- query_xenocanto(
df1 <- query_xenocanto(
species = "Zonotrichia capensis",
all_data = FALSE,
api_key = Sys.getenv("XENO_CANTO_API_KEY")
)
is.null(df1)
df1 <- query_xenocanto(
species = "Zonotrichia capensis",
api_key = Sys.getenv("XENO_CANTO_API_KEY")
)
df1 <- suwo::query_xenocanto(
species = "Zonotrichia capensis",
api_key = Sys.getenv("XENO_CANTO_API_KEY")
)
source("~/Dropbox/R_package_testing/suwo/R/query_xenocanto.R")
df1 <- suwo::query_xenocanto(
species = "Zonotrichia capensis",
api_key = Sys.getenv("XENO_CANTO_API_KEY")
)
source("~/Dropbox/R_package_testing/suwo/R/internal_functions.R")
df1 <- suwo::query_xenocanto(
species = "Zonotrichia capensis",
api_key = Sys.getenv("XENO_CANTO_API_KEY")
)
source("~/Dropbox/R_package_testing/suwo/R/query_xenocanto.R")
devtools::install()
df1 <- suwo::query_xenocanto(
species = "Zonotrichia capensis",
api_key = Sys.getenv("XENO_CANTO_API_KEY")
)
df1 <- query_xenocanto(
species = "Zonotrichia capensis",
api_key = Sys.getenv("XENO_CANTO_API_KEY")
)
source("~/Dropbox/R_package_testing/suwo/R/query_xenocanto.R")
devtools::install()
df1 <- suwo::query_xenocanto(
species = "Zonotrichia capensis",
api_key = Sys.getenv("XENO_CANTO_API_KEY")
)
devtools::document(".")
devtools::check(document = TRUE, run_dont_test = TRUE, vignettes = FALSE, manual = TRUE)
devtools::document(".")
devtools::check(document = TRUE, run_dont_test = TRUE, vignettes = FALSE, manual = TRUE)
df1 <- query_xenocanto(
species = "Zonotrichia capensis",
api_key = Sys.getenv("XENO_CANTO_API_KEY")
)
nrow(df1)
ncol(df1) == length(.format_query_output(only_basic_columns = T))
devtools::document(".")
devtools::check(document = TRUE, run_dont_test = TRUE, vignettes = FALSE, manual = TRUE)
devtools::document(".")
devtools::check(document = TRUE, run_dont_test = TRUE, vignettes = FALSE, manual = TRUE)
devtools::document(".")
devtools::check(document = TRUE, run_dont_test = TRUE, vignettes = FALSE, manual = TRUE)
devtools::document(".")
devtools::check(document = TRUE, run_dont_test = TRUE, vignettes = FALSE, manual = TRUE)
#' @param by Name of column to be used for coloring markers. Default is
#' "species".
#' @return An interacrive map with the locations of the observations.
#' @export
#' @name map_locations
#' @details This function creates maps for visualizing the geographic
#' spread of observations. Note that only recordings with geographic
#' coordinates are displayed.
#' @examples
#' # search in xeno-canto
phae_anth <- query_gbif(species = "Entoloma hochstetteri")
phae_anth
#' @param by Name of column to be used for coloring markers. Default is
#' "species".
#' @return An interacrive map with the locations of the observations.
#' @export
#' @name map_locations
#' @details This function creates maps for visualizing the geographic
#' spread of observations. Note that only recordings with geographic
#' coordinates are displayed.
#' @examples
#' # search in xeno-canto
phae_anth <- query_gbif(species = "Entoloma hochstetteri", verbose = TRUE)
phae_anth <- query_gbif(species = "Entoloma hochstetteri", format = "image")
run.all()
run.all()
e_hochs <- query_gbif(species = "Entoloma hochstetteri", format = "image")
View(e_hochs)
map_locations(e_hochs)
devtools::document(".")
devtools::check(document = TRUE, run_dont_test = TRUE, vignettes = FALSE, manual = TRUE)
devtools::document(".")
devtools::check(document = TRUE, run_dont_test = TRUE, vignettes = FALSE, manual = TRUE)
gb <- query_gbif(species = "Glaucis dohrnii", format = "sound")
gb
gb <- query_gbif(species = "Turdus rufiventris", format =  "sound")
wa <- query_wikiaves(species = "Turdus rufiventris", format =  "sound")
wa
options(verbose = TRUE)
gb <- query_gbif(species = "Turdus rufiventris", format =  "sound")
wa <- query_wikiaves(species = "Turdus rufiventris", format =  "sound")
source("~/Dropbox/R_package_testing/suwo/R/query_wikiaves.R")
#gb <- query_gbif(species = "Turdus rufiventris", format =  "sound")
wa <- query_wikiaves(species = "Turdus rufiventris", format =  "sound")
source("~/Dropbox/R_package_testing/suwo/R/query_wikiaves.R")
#gb <- query_gbif(species = "Turdus rufiventris", format =  "sound")
wa <- query_wikiaves(species = "Turdus rufiventris", format =  "sound")
source("~/Dropbox/R_package_testing/suwo/R/query_wikiaves.R")
#gb <- query_gbif(species = "Turdus rufiventris", format =  "sound")
wa <- query_wikiaves(species = "Turdus rufiventris", format =  "sound")
inat <- query_inaturalist(species = "Turdus rufiventris", format =  "sound")
merged_metadata <- merge_metadata(inat, gb)
label_dup_metadata <- find_duplicates(metadata = merged_metadata)
label_dup_metadata
View(label_dup_metadata)
devtools::document(".")
devtools::check(document = TRUE, run_dont_test = TRUE, vignettes = FALSE, manual = TRUE)
h_peckii <- query_inaturalist(species = 'Hydnellum peckii',
format = "image")
h_peckii <- query_inaturalist(species = 'Omphalotus olearius',
format = "image")
h_peckii <- query_inaturalist(species = 'Amanita zambiana',
format = "image")
## set XC Key
Sys.setenv(XENO_CANTO_API_KEY = getPass::getPass())
Sys.setenv(XENO_CANTO_API_KEY = getPass::getPass())
run.all()
options(verbose = TRUE)
devtools::test()
ml2 <- query_macaulay(
species = 'Harpia harpyja',
format = "image",
all_data = FALSE,
path = tempdir()
)
test_keys <- c("639757637", "639955653")
sml2 <- subset(ml2, key %in% test_keys)
a <- download_media(metadata = sml2, path = tempdir())
sml2
test_keys
table(ml2$key)
tab <- table(ml2$key)
names(tab)[tab == 1]
test_keys <- names(tab)[tab == 1][1:2]
test_keys
expected_files <- paste("Harpia_harpyja-ML",test_keys,".jpeg",sep="")
expected_files
a <- download_media(metadata = sml2, path = tempdir())
sml2 <- subset(ml2, key %in% test_keys)
a <- download_media(metadata = sml2, path = tempdir())
fls <- list.files(path = tempdir(),
pattern = "jpeg$",
ignore.case = TRUE)
expected_files <- paste("Harpia_harpyja-ML",test_keys,".jpeg",sep="")
all(expected_files %in% fls)
all(a$downloaded_file_name %in% fls)
df1 <- query_macaulay(
species = 'Calypte costae',
format = "image",
path = tempdir(),
dates = c(2022, 2024, 2025)
)
nrow(df1)
df1 <- query_macaulay(
species = 'Calypte costae',
format = "image",
path = tempdir(),
dates = c(2022, 2024, 2025)
)
df1 <- query_macaulay(
species = 'Calypte costae',
format = "image",
path = tempdir(),
dates = c(2022, 2024, 2025)
)
nrow(df1) >= 15000
df1 <- query_macaulay(
species = 'Glaucis dohrnii',
format =  "sound",
path = tempdir(),
dates = c(1979, 2022, 2026)
)
# remove last 3 rows to test update_metadata
sub_df <- df1[1:(nrow(df1) - 3), ]
up_df <- update_metadata(metadata = sub_df, path = tempdir())
nrow(up_df)
nrow(df1)
up_df <- update_metadata(metadata = sub_df, path = tempdir(),
dates = c(1979, 2022, 2026))
(nrow(up_df) == nrow(df1)
nrow(up_df) == nrow(df1)
# build tar.gz package file
system("R CMD build ./ --resave-data=best")
# build tar.gz package file
system("R CMD build ./ --resave-data=best")
